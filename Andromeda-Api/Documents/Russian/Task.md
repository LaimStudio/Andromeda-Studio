
# Task
## Описание
Task(задача) - это компонент Andromeda Studio и интерфейс Andromeda Api для создания собственных задач.
## Использование
В Andromeda Studio задачи реализуются классом, наследуемым от абстрактного класса Task.
```csharp
using AndromedaApi.Examples.Task;
namespace AndromedaApi.Examples.Task
{
    public class AsyncTask : Components.Task
    {
        
    }
}
```
Теперь вы можете переопределить метод Run. Он является некой точкой входа задачи. В нем нужно инициировать задачу и определить поведение при изменении состояния.

Вы можете сами определить, как именно будет выполняться ваша задача, но рекомендуется использовать асинхронные операции. 
Мы также рекомендуем использовать машину состояний из класса Task. Вы в любой момент можете получить или изменить свойство Status на одно из значений Task.TaskStatus. Вы также можете использовать событие OnStatus для оповещения об изменениях статуса задачи.
Вот так в примере AsyncTask.cs реализован метод Run с использованием асинхронных операций и машины состояний:
```csharp
public override void Run()
{
    System.Threading.Tasks.Task.Run(() =>
    {
        while (true)
        {
            if (Status == TaskStatus.Running)
            {
                Thread.Sleep(100);
                Console.WriteLine("Hello world");
            }
            else if (Status == TaskStatus.Error || Status == TaskStatus.Cancelled)
                break;
        }
		// Эта строка будет проингнорирована, так как 
		// единственный способ выйти из того цикла - определить статус отмены или ошибки,
		// а после этих операция последующие статусы игнорируются
        Status = TaskStatus.Finished;
    });
    Status = TaskStatus.Running;
}
```
Мы можем создать и запустить задачу вручную:
```csharp
var task = new AsyncTask();
task.Run();
Thread.Sleep(100);
task.Status = TaskStatus.Stopped;
Thread.Sleep(100);
task.Status = TaskStatus.Running;
Thread.Sleep(100);
task.Status = TaskStatus.Cancelled;
```
В ходе выполнения задачи в консоль будет три раза выведено `Hello world`

## Машина состояний
#### Planned
Состояние еще не начатой задачи. Свойство Task.Status имеет это значение по умолчанию.
#### Running
Состояние выполнения задачи. Это состояние определяется в непереопределенном методе Run. Его следует определять, когда задача начала свое выполнение.
#### Finished
Состояние успешно завершенной задачи. Все последующие изменения состояния игнорируются Andromeda Studio.
#### Error
Состояние задачи, завершенной с ошибкой. Все последующие изменения состояния игнорируются Andromeda Studio.
#### Stopped
Состояние остановленной задачи. По факту, все остановленные задачи должны возобновляться при последующем статусе Running.
#### Cancelled
Состояние отмененной пользователем задачи. Все последующие изменения состояния игнорируются Andromeda Studio.

## Запрет отмены и остановки
С помощью свойств IsStoppable и IsCancellable вы можете разрешить или запретить остановки и отмены задачи в пользовательском интерфейсе. Это не накладывает ограничения на машину состояний и статусы отмены и остановки все равно могут быть определены. Лучше, конечно, разрешать отмену и остановку, но если такой возможности нет можно использовать эти свойства, чтобы избежать ошибок